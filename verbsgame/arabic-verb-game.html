<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Arabic Verb Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background-color: #0e0f11;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      touch-action: none;
    }
    body {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .top-bar {
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .progress-wrapper {
      flex: 1;
      margin: 0 10px;
      background-color: #444;
      height: 8px;
      border-radius: 5px;
      overflow: hidden;
    }
    .progress {
      background-color: #90ee90;
      height: 100%;
      width: 0%;
      transition: width 0.3s;
    }
    .heart {
      color: red;
      font-size: 20px;
    }

    .question-section {
      text-align: center;
      margin-top: 10vh;
    }
    .question-section h2 {
      font-size: 18px;
      margin-bottom: 20px;
    }

    .card {
      background-color: #38bdf8;
      color: black;
      margin: 0 auto;
      width: 180px;
      height: 140px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 48px;
      font-weight: bold;
      border-radius: 20px;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 40px 20px 20px;
    }
    .option-btn {
      background-color: #1a1c1e;
      color: white;
      border: 2px solid #444;
      border-radius: 30px;
      padding: 12px;
      font-size: 18px;
      text-align: center;
      cursor: pointer;
    }
    .option-btn.selected {
      background-color: #444;
    }
    .option-btn.correct {
      background-color: #28a745;
    }
    .option-btn.wrong {
      background-color: #dc3545;
    }

    .bottom-button {
      text-align: center;
      margin: 20px;
    }
    .check-btn {
      background-color: #00c29e;
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 18px;
      padding: 12px 30px;
      width: 100%;
      max-width: 400px;
      cursor: pointer;
    }
    .check-btn:disabled {
      background-color: #555;
    }
  </style>
</head>
<body>

<div class="top-bar">
  <div class="heart">‚ù§Ô∏è x <span id="lives">5</span></div>
  <div class="progress-wrapper"><div class="progress" id="progressBar"></div></div>
</div>

<div class="question-section">
  <h2 id="questionText">What sound does this make?</h2>
  <div class="card" id="cardArabic">...</div>
</div>

<div class="options" id="optionsList"></div>

<div class="bottom-button">
  <button class="check-btn" id="checkBtn" onclick="checkAnswer()" disabled>CHECK</button>
</div>

<!-- Load external dataset -->
<script src="verb_data.js"></script>
<script>
let total = 10;
let current = 0;
let score = 0;
let lives = 5;
let mode = "";
let correctAnswer = "";
let selected = null;

function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function loadQuestion() {
  selected = null;
  document.getElementById("checkBtn").disabled = true;
  const currentData = dataset[current % dataset.length];
  const others = shuffle(dataset.filter(d => d !== currentData)).slice(0, 2);
  const options = shuffle([currentData, ...others]);

  mode = Math.random() > 0.5 ? "A2E" : "E2A";
  correctAnswer = mode === "A2E" ? currentData.meaning : currentData["3MSAP_root"];

  document.getElementById("cardArabic").textContent = mode === "A2E" ? currentData["3MSAP_root"] : currentData.meaning;
  document.getElementById("questionText").textContent = mode === "A2E"
    ? "What sound does this make?"
    : "Which Arabic script makes this sound?";

  const optContainer = document.getElementById("optionsList");
  optContainer.innerHTML = "";

  options.forEach(opt => {
    const val = mode === "A2E" ? opt.meaning : opt["3MSAP_root"];
    const btn = document.createElement("button");
    btn.className = "option-btn";
    btn.textContent = val;
    btn.onclick = () => {
      document.querySelectorAll(".option-btn").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      selected = val;
      document.getElementById("checkBtn").disabled = false;
    };
    optContainer.appendChild(btn);
  });

  updateProgress();
}

function checkAnswer() {
  const all = document.querySelectorAll(".option-btn");
  all.forEach(btn => {
    btn.classList.remove("selected");
    btn.disabled = true;
    if (btn.textContent === correctAnswer) {
      btn.classList.add("correct");
    } else if (btn.textContent === selected) {
      btn.classList.add("wrong");
    }
  });

  if (selected === correctAnswer) {
    score++;
  } else {
    lives--;
    document.getElementById("lives").textContent = lives;
  }

  setTimeout(() => {
    current++;
    if (lives <= 0 || current >= total) {
      endGame();
    } else {
      loadQuestion();
    }
  }, 1200);
}

function updateProgress() {
  const pct = (current / total) * 100;
  document.getElementById("progressBar").style.width = pct + "%";
}

function endGame() {
  document.querySelector(".question-section").innerHTML = `<h2>üéØ Final Score: ${Math.round((score / total) * 100)}%</h2>`;
  document.getElementById("optionsList").innerHTML = "";
  document.getElementById("checkBtn").style.display = "none";
}

window.onload = loadQuestion;
</script>
</body>
</html>
